<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Jazz Mini Hoops Game</title>
  <style>
    :root {
      --jazz-navy: #002b5c;
      --jazz-gold: #f9a01b;
      --jazz-purple: #4b2e83;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, var(--jazz-purple), var(--jazz-navy));
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #ffffff;
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 16px;
      margin-bottom: 4px;
      letter-spacing: 1px;
    }

    .subtitle {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 0.9rem;
      opacity: 0.85;
    }

    .hud {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .hud span {
      padding: 4px 10px;
      border-radius: 999px;
      background-color: rgba(0, 0, 0, 0.3);
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    button {
      border: none;
      padding: 6px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.85rem;
      background-color: rgba(0, 0, 0, 0.4);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: transform 0.08s ease, background-color 0.15s ease;
    }

    button:hover {
      background-color: rgba(0, 0, 0, 0.6);
      transform: translateY(-1px);
    }

    button.active {
      background-color: var(--jazz-gold);
      color: #000;
      border-color: #000;
    }

    #shootBtn {
      background-color: var(--jazz-gold);
      color: #000;
      font-weight: 600;
      margin-top: 4px;
    }

    canvas {
      display: block;
      margin: 10px auto 0 auto;
      background: var(--jazz-navy);
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      touch-action: manipulation; /* helps mobile taps */
    }

    a.back-link {
      color: var(--jazz-gold);
      margin: 14px 0 18px 0;
      text-decoration: none;
      font-size: 0.95rem;
    }

    a.back-link:hover {
      text-decoration: underline;
    }

    @media (max-width: 600px) {
      canvas {
        width: 95vw;
        height: auto;
      }
    }
  </style>
</head>
<body>

  <h1>Jazz Mini Hoops</h1>
  <p class="subtitle">Tap, click, or press space to shoot. 60 seconds. Rack up a streak!</p>

  <div class="hud">
    <span id="scoreDisplay">Score: 0</span>
    <span id="streakDisplay">Streak: 0</span>
    <span id="multDisplay">Multiplier: x1</span>
    <span id="timerDisplay">Time: 60</span>
    <span id="bestDisplay">Best: 0</span>
  </div>

  <div class="controls-row">
    <button id="easyBtn" class="active">Easy</button>
    <button id="normalBtn">Normal</button>
    <button id="hardBtn">Hard</button>
    <button id="pauseBtn">Pause</button>
    <button id="restartBtn">Restart</button>
  </div>

  <button id="shootBtn">Shoot</button>

  <canvas id="gameCanvas" width="500" height="600"></canvas>

  <a href="scratch.html" class="back-link">‚Üê Back to Scratch Page</a>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // HUD elements
    const scoreDisplay = document.getElementById("scoreDisplay");
    const streakDisplay = document.getElementById("streakDisplay");
    const multDisplay = document.getElementById("multDisplay");
    const timerDisplay = document.getElementById("timerDisplay");
    const bestDisplay = document.getElementById("bestDisplay");

    const easyBtn = document.getElementById("easyBtn");
    const normalBtn = document.getElementById("normalBtn");
    const hardBtn = document.getElementById("hardBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const restartBtn = document.getElementById("restartBtn");
    const shootBtn = document.getElementById("shootBtn");

    // Game state
    let score = 0;
    let streak = 0;
    let multiplier = 1;
    let bestScore = 0;

    let remainingTime = 60;
    let paused = false;
    let gameOver = false;
    let lastTimestamp = null;

    // Difficulty config
    const difficulties = {
      easy: {
        hoopSpeed: 1,
        rimWidth: 150,
        gravity: 0.25,
        basePower: 12
      },
      normal: {
        hoopSpeed: 1.5,
        rimWidth: 120,
        gravity: 0.28,
        basePower: 11
      },
      hard: {
        hoopSpeed: 2.1,
        rimWidth: 95,
        gravity: 0.3,
        basePower: 10
      }
    };

    let currentDifficulty = "easy";
    let config = { ...difficulties[currentDifficulty] };

    // Hoop
    const hoopY = 130;
    const rimThickness = 8;
    let hoopBaseX = canvas.width / 2;
    let hoopRange = 110; // side-to-side travel
    let hoopX = hoopBaseX - hoopRange;
    let hoopDirection = 1;

    // Ball
    const startBallY = 520;
    let ball = {
      x: canvas.width / 2,
      y: startBallY,
      radius: 16,
      vx: 0,
      vy: 0,
      isShot: false,
      shotScored: false
    };

    // Particles for scoring
    const particles = [];

    function createScoreParticles(x, y) {
      for (let i = 0; i < 25; i++) {
        particles.push({
          x,
          y,
          vx: (Math.random() - 0.5) * 4,
          vy: (Math.random() - 1.0) * 4,
          life: 0,
          maxLife: 40 + Math.random() * 20,
          color: Math.random() < 0.5 ? "#f9a01b" : "#ffffff"
        });
      }
    }

    function updateParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1; // slight gravity
        p.life++;

        if (p.life > p.maxLife) {
          particles.splice(i, 1);
        }
      }
    }

    function drawParticles() {
      particles.forEach(p => {
        const alpha = 1 - p.life / p.maxLife;
        ctx.fillStyle = p.color;
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      });
    }

    // Load best score
    (function loadBest() {
      try {
        const stored = localStorage.getItem("jazzMiniHoopsBest");
        if (stored !== null) {
          bestScore = parseInt(stored, 10) || 0;
        }
      } catch (e) {
        bestScore = 0;
      }
      bestDisplay.textContent = "Best: " + bestScore;
    })();

    function saveBest() {
      try {
        localStorage.setItem("jazzMiniHoopsBest", String(bestScore));
      } catch (e) {}
    }

    function resetBall() {
      ball.x = canvas.width / 2;
      ball.y = startBallY;
      ball.vx = 0;
      ball.vy = 0;
      ball.isShot = false;
      ball.shotScored = false;
    }

    function shootBall() {
      if (gameOver || paused) return;
      if (ball.isShot) return;

      ball.isShot = true;
      ball.shotScored = false;

      // Slight randomness to arc
      const horizontalRandom = (Math.random() * 4) - 2; // -2 to +2
      ball.vx = horizontalRandom;
      ball.vy = -(config.basePower + Math.random() * 2);
    }

    // Drawing functions
    function drawCourt() {
      // Court base
      ctx.fillStyle = "#0f2545";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Wood rectangle
      ctx.fillStyle = "#c59b6d";
      ctx.fillRect(40, 180, canvas.width - 80, canvas.height - 220);

      // Center circle
      ctx.strokeStyle = "#ffffff";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(canvas.width / 2, 350, 60, 0, Math.PI * 2);
      ctx.stroke();

      // Free throw arc (top)
      ctx.beginPath();
      ctx.arc(canvas.width / 2, 240, 40, Math.PI, 0);
      ctx.stroke();

      // "Jazz" text on court
      ctx.fillStyle = "rgba(255,255,255,0.12)";
      ctx.font = "bold 42px system-ui";
      ctx.textAlign = "center";
      ctx.fillText("JAZZ", canvas.width / 2, 380);
      ctx.textAlign = "left";
    }

    function drawHoop() {
      const rimWidth = config.rimWidth;

      // Backboard
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(hoopX - 30, hoopY - 40, 60, 40);

      // Rim
      ctx.fillStyle = "#ff3b3b";
      ctx.fillRect(hoopX - rimWidth / 2, hoopY, rimWidth, rimThickness);

      // Net (just a hint)
      ctx.strokeStyle = "#ffffff";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(hoopX - rimWidth / 2, hoopY + rimThickness);
      ctx.lineTo(hoopX, hoopY + 35);
      ctx.lineTo(hoopX + rimWidth / 2, hoopY + rimThickness);
      ctx.stroke();
    }

    function drawBall() {
      // Ball
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = "#f9a01b";
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#d87e00";
      ctx.stroke();

      // Seams
      ctx.strokeStyle = "#d87e00";
      ctx.lineWidth = 1.5;

      // Vertical seam
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius - 1, -Math.PI / 2, Math.PI / 2);
      ctx.stroke();

      // Horizontal seam
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius - 1, 0, Math.PI);
      ctx.stroke();
    }

    function updateHoop(delta) {
      const speed = config.hoopSpeed;
      hoopX += hoopDirection * speed * (delta / 16.67); // normalized to ~60fps

      if (hoopX > hoopBaseX + hoopRange) {
        hoopX = hoopBaseX + hoopRange;
        hoopDirection = -1;
      } else if (hoopX < hoopBaseX - hoopRange) {
        hoopX = hoopBaseX - hoopRange;
        hoopDirection = 1;
      }
    }

    function updateBall(delta) {
      if (!ball.isShot) return;

      ball.x += ball.vx * (delta / 16.67);
      ball.y += ball.vy * (delta / 16.67);
      ball.vy += config.gravity * (delta / 16.67);

      // Score detection: ball passing through net area while moving downward
      const rimWidth = config.rimWidth;
      const netTop = hoopY + rimThickness;
      const netBottom = netTop + 28;
      const netLeft = hoopX - rimWidth / 2 + rimWidth * 0.2;
      const netRight = hoopX + rimWidth / 2 - rimWidth * 0.2;

      const withinX = ball.x > netLeft && ball.x < netRight;
      const withinY =
        ball.y + ball.radius > netTop &&
        ball.y - ball.radius < netBottom;

      if (
        ball.vy > 0 && // moving down
        !ball.shotScored &&
        withinX &&
        withinY
      ) {
        handleScore();
        return;
      }

      // Missed shot: off screen or way off to the side
      if (ball.y - ball.radius > canvas.height + 40 ||
          ball.x + ball.radius < -40 ||
          ball.x - ball.radius > canvas.width + 40) {
        handleMiss();
      }
    }

    function handleScore() {
      ball.shotScored = true;

      // Increase streak and multiplier
      streak++;
      multiplier = 1 + Math.floor(streak / 3); // every 3 in a row, +1
      if (multiplier > 5) multiplier = 5;

      const points = 1 * multiplier;
      score += points;

      if (score > bestScore) {
        bestScore = score;
        saveBest();
      }

      // HUD update
      scoreDisplay.textContent = "Score: " + score;
      streakDisplay.textContent = "Streak: " + streak;
      multDisplay.textContent = "Multiplier: x" + multiplier;
      bestDisplay.textContent = "Best: " + bestScore;

      createScoreParticles(ball.x, ball.y);

      // Nice little reset after a short delay
      setTimeout(() => {
        resetBall();
      }, 200);
    }

    function handleMiss() {
      streak = 0;
      multiplier = 1;
      streakDisplay.textContent = "Streak: " + streak;
      multDisplay.textContent = "Multiplier: x" + multiplier;
      resetBall();
    }

    function updateTimer(delta) {
      if (paused || gameOver) return;
      remainingTime -= delta / 1000;
      if (remainingTime <= 0) {
        remainingTime = 0;
        gameOver = true;
      }
      timerDisplay.textContent = "Time: " + Math.max(0, Math.floor(remainingTime));
    }

    function drawGameOverOverlay() {
      if (!gameOver) return;
      ctx.fillStyle = "rgba(0,0,0,0.65)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#ffffff";
      ctx.font = "bold 30px system-ui";
      ctx.textAlign = "center";
      ctx.fillText("Time's Up!", canvas.width / 2, canvas.height / 2 - 10);

      ctx.font = "18px system-ui";
      ctx.fillText("Final Score: " + score, canvas.width / 2, canvas.height / 2 + 18);
      ctx.fillText("Best: " + bestScore, canvas.width / 2, canvas.height / 2 + 42);

      ctx.textAlign = "left";
    }

    function gameLoop(timestamp) {
      if (!lastTimestamp) lastTimestamp = timestamp;
      const delta = timestamp - lastTimestamp;
      lastTimestamp = timestamp;

      // Update
      if (!paused && !gameOver) {
        updateHoop(delta);
        updateBall(delta);
        updateTimer(delta);
        updateParticles();
      } else {
        // still update particles for nice fade even when paused/game over
        updateParticles();
      }

      // Draw
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawCourt();
      drawHoop();
      drawBall();
      drawParticles();
      drawGameOverOverlay();

      requestAnimationFrame(gameLoop);
    }

    // Difficulty handling
    function setDifficulty(mode) {
      currentDifficulty = mode;
      config = { ...difficulties[mode] };

      easyBtn.classList.remove("active");
      normalBtn.classList.remove("active");
      hardBtn.classList.remove("active");

      if (mode === "easy") easyBtn.classList.add("active");
      if (mode === "normal") normalBtn.classList.add("active");
      if (mode === "hard") hardBtn.classList.add("active");
    }

    easyBtn.addEventListener("click", () => setDifficulty("easy"));
    normalBtn.addEventListener("click", () => setDifficulty("normal"));
    hardBtn.addEventListener("click", () => setDifficulty("hard"));

    // Pause / Resume
    pauseBtn.addEventListener("click", () => {
      if (gameOver) return;
      paused = !paused;
      pauseBtn.textContent = paused ? "Resume" : "Pause";
    });

    // Restart game
    function restartGame() {
      score = 0;
      streak = 0;
      multiplier = 1;
      remainingTime = 60;
      gameOver = false;
      paused = false;
      pauseBtn.textContent = "Pause";

      resetBall();

      scoreDisplay.textContent = "Score: " + score;
      streakDisplay.textContent = "Streak: " + streak;
      multDisplay.textContent = "Multiplier: x" + multiplier;
      timerDisplay.textContent = "Time: " + remainingTime;
    }

    restartBtn.addEventListener("click", restartGame);

    // Shooting controls
    shootBtn.addEventListener("click", shootBall);
    canvas.addEventListener("click", shootBall);

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        shootBall();
      }
      if (e.code === "KeyR") {
        restartGame();
      }
    });

    // Start game loop
    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>
